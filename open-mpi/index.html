<!DOCTYPE html>
<html>

<head>
  <title>Open MPI</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="LibPFASST dynamic resources documentation" />
  <meta name="keywords" content="HPC,Parallel-in-Time" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- bootstrap css -->
  <link href="https://fecht.cc/libpfasst-doc/bootstrap-5.3.0.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

<style>
/* flip the arrow when the content is collapsed */
.collapsed .togglearrow {
  transform: rotate(90deg);
  display: inline-block;
}
.togglearrow {
  transform: rotate(180deg);
  color: black;
  display: inline-block;
}

td {
  padding: 0 15px;
}
th {
  padding: 0 15px;
}

/* search results */
.search-container {
  display: inline-block;
  position: relative;
  width: 300px;
}

.search-container input {
  width: 100%;
  padding: 0.5rem;
}

.search-results {
  display: none;
  position: absolute;
  background: white;
  color: black;
  padding: 1rem;
  box-shadow: 2px 2px 2px 0 rgba(0, 0, 0, 0.5);
  max-height: 500px;
  overflow: auto;
  width: 150%;
  right: 0;
}

/* Search results on mobile have 100% width*/
@media (max-width: 767px) {
  .search-results {
    width: 100%;
  }/* SM breakpoint */

  /* CUSTOM WIDTHS */
  .w-md-25 { width: 25%!important; }
  .w-md-50 { width: 50%!important; }
  .w-md-75 { width: 75%!important; }
  .w-md-100 { width: 100%!important; }
}

.search-results__items {
  list-style: none;
}


.search-results__items > li {
  margin-top: 1rem;
  border-bottom: 1px solid #ccc;
  font-size: 0.9rem;

}
.search-results__items li:first-of-type {
  margin-top: 0;
}

.search-results__item {
  margin-bottom: 1rem;
}

.search-results__item > a {
  font-size: 1.2rem;
  display: inline-block;
  margin-bottom: 0.5rem;
}


.text-muted > a {
  color: var(--bs-secondary-color) !important;
}

</style>
</head>

<body>

  <div class="container border pt-3 my-3">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light px-2" style="background-color: #e3f2fd;">

      <a class="navbar-brand" href="https://fecht.cc/libpfasst-doc/">Dynamic LibPFASST</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 mr-auto">
          <li class="nav-item">
            <a class="nav-link active" href="https://fecht.cc/libpfasst-doc/open-mpi/">Open MPI</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://fecht.cc/libpfasst-doc/libpfasst/">LibPFASST</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="https://fecht.cc/libpfasst-doc/showcase/">Showcase</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="https://fecht.cc/libpfasst-doc/tools/">Tools</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="https://fecht.cc/libpfasst-doc/libmpidynres/">libmpidynres</a>
          </li>
        </ul>


        <div class="search-container navbar-form navbar-right mx-2">
            <input id="search" type="search" placeholder="ðŸ”Ž Search this site" aria-label="Search">

            <div class="search-results">
                <div class="search-results__items"></div>
            </div>
        </div>
      </div> <!-- End of Collapse -->
    </nav>

    <!-- content -->
    <div class="pt-3">
      
      <h1 id="open-mpi">Open MPI</h1>
<p>Open MPI is a free and open-source implemention of the MPI standard.</p>
<h2 id="contributions-to-upstream">Contributions to Upstream</h2>
<p>MPI Sessions support, especially in Fortran, is still lacking in the offical Open MPI repo (as of early 2023).
In this project, two pull requests were created and merged to the upstream Open MPI repository:</p>
<ul>
<li><a rel="noopener" target="_blank" href="https://github.com/open-mpi/ompi/pull/11496">ompi/pull/11496</a>: <em>Add MPI_SESSION_NULL to fortran</em> - make the constant <code>MPI_SESSION_NULL</code> available in Fortran programs</li>
<li><a rel="noopener" target="_blank" href="https://github.com/open-mpi/ompi/pull/11487">ompi/pull/11487</a>: <em>Fix wrong buffer size in ompi_session_get_nth_pset_f</em> - fix a buffer overflow in one of the Fortran MPI Sessions calls</li>
</ul>
<h2 id="dynamic-open-mpi-fork">Dynamic Open MPI Fork</h2>
<p>A new API for dynamic resource management was introduced by Huber et al in <em>Towards Dynamic Resource Management with MPI Sessions and PMIx</em> (2022).
This API has been continously refined and is the basis for the final version of this project.</p>
<p>In the course of this IDP, a Fortran interface was derived for version <code>v2a</code> of the Open MPI prototype introduced by Dominik Huber (<a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/-/tree/fortran-support">link to repo</a>).
This interface was added to said Open MPI fork and has been merged into the <code>main</code> branch.</p>
<p>The interface is specified in Fortran 90, as this is the MPI version that LibPFASST uses.
However, little work is required to add Fortran 08 support.</p>
<p>Also, the non-blocking variants of the MPI Sessions API (<code>MPI_Session_dyn_v2a_psetop_nb</code>, <code>MPI_Session_dyn_v2a_query_psetop_nb</code>, <code>MPI_Session_get_pset_data_nb</code>) could not be implemented in Fortran, due to required conversion of the results of these calls.</p>
<div class="alert alert-warning position-static" role="alert">
  Warning: Due to the representation of strings in Fortran, spaces are disallowed in process set names.
</div>
<div class="alert alert-warning position-static" role="alert">
  Warning: As of May 2023, the implementation (both for C and Fortran) only allows growing and shrinking in a node-wise granularity. If, for example, you are running a job on several nodes with 8 reserved processes each, you can only grow and shrink by a multiple of 8 processes at once.
</div>
<h3 id="setup-instructions-for-docker-cluster">Setup instructions for Docker Cluster</h3>
<p>It is advised to use the repository and follow the setup instructions described in the quickguide <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/docker-cluster">here</a> to setup a multi-container docker cluster on your computer.
Alternatively, you can also try to manually build the components: <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/prrte">prrte</a>,
<a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/openpmix">openpmix</a>,
<a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi">ompi</a>.</p>
<p>For development, it might help to enable debug symbols within Open MPI and other runtime libraries. To enable these, add the <code>--enable-debug</code> flag when running <code>install_docker.sh</code>.</p>
<h3 id="setup-instructions-for-running-on-the-lrz-linux-cluster">Setup instructions for running on the LRZ Linux Cluster</h3>
<p>Based on the information provided here: <a rel="noopener" target="_blank" href="https://doku.lrz.de/display/PUBLIC/Building+software+in+user+space+with+spack">https://doku.lrz.de/display/PUBLIC/Building+software+in+user+space+with+spack</a></p>
<ol>
<li>Download the spack packages for the Open MPI fork: <span style="font-size: 13px"><a href="https://fecht.cc/libpfasst-doc/open-mpi/./spack_packages.zip">spack_packages.zip</a></span></li>
<li>Copy the zip file into the home directory in your LRZ login node and unzip it there :</li>
</ol>
<pre data-lang="bash" style="background-color:#fafafa;color:#383a42;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e45649;">unzip</span><span> spack_packages.zip
</span></code></pre>
<ol start="3">
<li>Load spack user utilities:</li>
</ol>
<pre data-lang="bash" style="background-color:#fafafa;color:#383a42;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e45649;">module</span><span> load user_spack
</span></code></pre>
<ol start="4">
<li>Create your own spack repo:</li>
</ol>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>mkdir -p ~/spack_repos
</span><span>spack repo create ~/spack/repos/mine
</span></code></pre>
<ol start="5">
<li>Move packages into your repo:</li>
</ol>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>mv packages ~/spack/repos/mine/
</span></code></pre>
<ol start="6">
<li>Install the packages:</li>
</ol>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>spack install dyn_ompi
</span></code></pre>
<p>From then on, to activate the environment after logging in, run:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>module load user_spack
</span><span>spack load dyn_ompi
</span></code></pre>
<p>To run an MPI application with the fork, it is currently best to allocate an interactive session:</p>
<ol>
<li>Allocate session (replace <code>NNODES</code> with the number of nodes you want to allocate):</li>
</ol>
<pre data-lang="bash" style="background-color:#fafafa;color:#383a42;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e45649;">salloc --nodes</span><span> NNODES ...
</span></code></pre>
<ol start="2">
<li>Run your application (replace <code>PROCS_PER_NODE</code> with the number of processors available on each node, which is also the granularity of the addition/removal of resources):</li>
</ol>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>mpirun --host $(scontrol show hostname $SLURM_NODELIST | sed &#39;s/$/:PROCS_PER_NODE/g&#39;  | tr &#39;\n&#39; &#39;,&#39;) &lt;further mpirun arguments&gt; ...
</span></code></pre>
<h2 id="example-application">Example Application</h2>
<p>A proof of concept, loop-based MPI Fortran application is available for testing the API <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/test_applications/-/blob/fortran-support/examples/dyn_mpi_sessions_v2a.f90">here</a>. It behaves similar to the C examples in the same project.</p>
<p>If you followed the quickguide linked above, the <code>test_applications</code> folder should already be available in your docker cluster.
Make sure that you have started the docker cluster and entered the environment using the <code>./mpiuser-drop-in.sh</code> script.</p>
<p>Then run the following commands:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>cd /opt/hpc/build/test_applications
</span><span>
</span><span># build fortran example in release mode
</span><span>scons example=DynMPISessions_v2a_fortran compileMode=release
</span></code></pre>
<p>The resulting binary is available at <code>build/DynMPISessions_v2a_fortran_release</code>.</p>
<p>The following flags are available:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>Usage: ./build/DynMPISessions_v2a_fortran_release [-d] [-c &lt;ITER_MAX&gt;] [-l &lt;proc_limit&gt;] [-n &lt;num_delta&gt;] [-f &lt;rc_frequency&gt;] [-m &lt;mode_string&gt;]
</span><span>
</span><span>Options:
</span><span>  -d                  Enable debug prints
</span><span>  -c &lt;ITER_MAX&gt;       Maximum number of iterations (default: 200)
</span><span>  -l &lt;proc_limit&gt;     Maximum (or minimum in s_/b_ mode) number of processors (default: 64)
</span><span>  -n &lt;num_delta&gt;      Number of delta values (default: 8)
</span><span>  -f &lt;rc_frequency&gt;   Frequency of resource change steps (default: 10)
</span><span>  -m &lt;mode_string&gt;    Mode (default: i+)
</span></code></pre>
<p>I recommend using <code>tmpi.py</code> (described in the <a href="https://fecht.cc/libpfasst-doc/tools/">Tools section</a>) to run the examples with a nice visualization of the processes:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span># download tmpi.py
</span><span>wget https://raw.githubusercontent.com/boi4/tmpi-py/main/tmpi.py
</span><span>chmod +x tmpi.py
</span><span>
</span><span># run fortran example with tmpi.py
</span><span>MPIRUNARGS=&quot;--display map --mca btl_tcp_if_include eth0 --host n01:4,n02:4,n03:4,n04:4  -x LD_LIBRARY_PATH -x DYNMPI_BASE&quot; \
</span><span>        ./tmpi.py 16 \
</span><span>        build/DynMPISessions_v2a_fortran_release -d -c 3000 -l 1 -m s_ -n 4 -f 200
</span></code></pre>
<h2 id="implementation-details">Implementation Details</h2>
<p>For a list of code changes, check out the <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/-/commits/fortran-support">commit history on GitLab</a>.</p>
<p>To add a new Fortran function to Open MPI, the following steps can be used when in the root of the <a rel="noopener" target="_blank" href="https://github.com/open-mpi/ompi">Open MPI repository</a>.
I am documenting this here, as I could not find this information easily online:</p>
<ol>
<li>Create a file in <code>ompi/ompi/mpi/fortran/mpif-h/</code> with the name of your function (check existing files to get the idea)</li>
<li>Add this file to <code>ompi/ompi/fortran/mpif-h/Makefile.am</code></li>
<li>Create a symlink in <code>ompi/ompi/mpi/fortran/mpif-h/profile/</code> with &quot;p&quot; at start of filename: <code>ln -s ../../../../../ompi/mpi/fortran/mpif-h/${name} p${name}</code></li>
<li>Add this Symlink to <code>ompi/ompi/mpi/fortran/mpif-h/profile/Makefile.am</code></li>
<li>Add the Fortran interface to <code>ompi/ompi/fortran/use-mpi-ignore-tkr/mpi-ignore-tkr-interfaces.h.in</code></li>
<li>Add the Fortran interface to <code>ompi/ompi/fortran/use-mpi-tkr/mpi-f90-interfaces.h</code></li>
<li>Add a line to <code>ompi/ompi/fortran/mpif-h/prototypes_mpi.h</code></li>
<li>Add a line to <code>ompi/ompi/fortran/use-mpi-ignore-tkr/pmpi-ignore-tkr-interfaces.h</code></li>
</ol>
<p>The most important file is the one created in the first step.
It includes the C implementation of the Fortran call.
For this, the Fortran arguments are automatically translated into C arguments, as described <a rel="noopener" target="_blank" href="https://gcc.gnu.org/onlinedocs/gcc-9.4.0/gfortran/Argument-passing-conventions.html">here</a>.</p>
<p>Importantly, each argument is passed as a single pointer type (even multi-dimensional arrays). For each string type argument, a hidden additional argument specifying the string's length is passed.</p>
<p>Open MPI offers multiple conversion functions which were used to implement the functions for this project.</p>
<p>After the conversion of the input arguments, the internal Open MPI function is called with the converted arguments.
The &quot;OUT&quot; parameters of this call are converted back into fortran after the internal function returns.</p>
<hr />
<a href="#f90API" class="collapsed" data-bs-toggle="collapse" data-bs-target="#f90API" aria-expanded="false" aria-controls="f90API" style="text-decoration: none; color: black;">
<h3><span class="togglearrow" >â–²</span>Fortran 90 v2a API (click to expand)</h3>
</a>
<div id="f90API" class="collapse">
<h5 id="constants">Constants</h5>
<p>The following new constants are available in the <code>mpi</code> module:</p>
<pre data-lang="f08" style="background-color:#fafafa;color:#383a42;" class="language-f08 "><code class="language-f08" data-lang="f08"><span>integer MPI_PSETOP_NULL
</span><span>integer MPI_PSETOP_ADD
</span><span>integer MPI_PSETOP_SUB
</span><span>integer MPI_PSETOP_REPLACE
</span><span>integer MPI_PSETOP_MALLEABLE
</span><span>integer MPI_PSETOP_GROW
</span><span>integer MPI_PSETOP_SHRINK
</span><span>integer MPI_PSETOP_UNION
</span><span>integer MPI_PSETOP_DIFFERENCE
</span><span>integer MPI_PSETOP_INTERSECTION
</span><span>integer MPI_PSETOP_SPLIT
</span></code></pre>
<p>These constants are used for the <code>op</code> and <code>type</code> arguments in <code>MPI_Session_dyn_v2a_psetop</code> and <code>MPI_Session_dyn_v2a_query_psetop</code> and represent the respective pset operation.</p>
<p>Note that <code>MPI_PSETOP_SHRINK</code>, <code>MPI_PSETOP_GROW</code>, <code>MPI_PSETOP_ADD</code> and <code>MPI_PSETOP_SUB</code> modify the available resources of the application.
The other pset operations only recombine existing process sets.</p>
<h5 id="subroutines">Subroutines</h5>
<p>Analogously to existing Fortran subroutines in the MPI standard, the corresponding Fortran routines have the same name and arguments as their C counterpart.
Additionally, an optional <code>integer ierror</code> argument can be added at the end of each call to get the return status of the operation.</p>
<p>The exception is the <code>output_psets</code> argument of <code>MPI_Session_dyn_v2a_psetop</code> and <code>MPI_Session_dyn_v2a_query_psetop</code>.
Instead of being allocated by the Open MPI runtime, it requires the user to pre-allocate these.
The reason for this is the difficulty of allocating Fortran objects in C. Furthermore, this has an additional benefit: It is easier to broadcast <code>output_psets</code>, as other processes might also allocate <code>output_psets</code> before the call.</p>
<p>String arguments that contain a process set name and are of type <code>IN</code> or <code>INOUT</code> should be able to hold at least <code>MPI_MAX_PSET_NAME_LEN</code> arguments (constant is available in the <code>mpi</code> module).
Furthermore, process set names are terminated by filling the rest of the string with blanks (<code>' '</code>, ASCII 0x20).</p>
<hr />
<p><strong>PSet Data Routines</strong></p>
<hr />
<pre data-lang="f90" style="background-color:#fafafa;color:#383a42;" class="language-f90 "><code class="language-f90" data-lang="f90"><span style="color:#a626a4;">interface
</span><span style="color:#a626a4;">subroutine </span><span style="color:#0184bc;">MPI_Session_get_pset_data</span><span>(</span><span style="color:#e45649;">session</span><span>, </span><span style="color:#e45649;">pset_name</span><span> , </span><span style="color:#e45649;">coll_pset_name</span><span>, </span><span style="color:#e45649;">keys</span><span>, </span><span style="color:#e45649;">nkeys</span><span>, </span><span style="color:#e45649;">wait</span><span>, </span><span style="color:#e45649;">info_used</span><span>, </span><span style="color:#e45649;">ierror</span><span>)
</span><span>  </span><span style="color:#a626a4;">implicit none
</span><span>  integer,                        intent(in)  </span><span style="color:#a626a4;">::</span><span> session
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>,               </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)  </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">coll_pset_name
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>,               </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)  </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">pset_name
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">dimension</span><span>(*), </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)  </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">keys
</span><span>  integer,                        intent(in)  </span><span style="color:#a626a4;">::</span><span> nkeys
</span><span>  integer,                        intent(in)  </span><span style="color:#a626a4;">::</span><span> wait
</span><span>  integer,                        intent(out) </span><span style="color:#a626a4;">::</span><span> info_used
</span><span>  integer,                        intent(out) </span><span style="color:#a626a4;">::</span><span> ierror
</span><span style="color:#a626a4;">end subroutine </span><span style="color:#0184bc;">MPI_Session_get_pset_data
</span><span style="color:#a626a4;">end interface
</span></code></pre>
<ul>
<li>Works analogously to the C version.</li>
</ul>
<p>From <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/#process-set-dictionaries">the C documentation</a>:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>RETURN: 
</span><span>   - MPI_SUCCESS if operation was successful
</span><span>
</span><span>Description:   Publishes a key-value pair in the dictionary associated with the given PSet name.
</span><span>               The PSet name has to exist.
</span></code></pre>
<hr />
<br/>
<hr />
<pre data-lang="f90" style="background-color:#fafafa;color:#383a42;" class="language-f90 "><code class="language-f90" data-lang="f90"><span style="color:#a626a4;">interface
</span><span style="color:#a626a4;">subroutine </span><span style="color:#0184bc;">MPI_Session_set_pset_data</span><span> (</span><span style="color:#e45649;">session</span><span>, </span><span style="color:#e45649;">pset_name</span><span>, </span><span style="color:#e45649;">info_used</span><span>, </span><span style="color:#e45649;">ierror</span><span>)
</span><span>  </span><span style="color:#a626a4;">implicit none
</span><span>  integer,          intent(in)  </span><span style="color:#a626a4;">::</span><span> session
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)  </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">pset_name
</span><span>  integer,          intent(in)  </span><span style="color:#a626a4;">::</span><span> info_used
</span><span>  integer,          intent(out) </span><span style="color:#a626a4;">::</span><span> ierror
</span><span style="color:#a626a4;">end subroutine </span><span style="color:#0184bc;">MPI_Session_set_pset_data
</span><span style="color:#a626a4;">end interface
</span></code></pre>
<ul>
<li>Works analogously to the C version.</li>
</ul>
<p>From <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/#process-set-dictionaries">the C documentation</a>:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>RETURN: 
</span><span>   - MPI_SUCCESS if operation was successful
</span><span>Description:   Looks up a key-value pair in the dictionary associated with the given PSet name.
</span><span>               The PSet name has to exist.
</span><span>               The call is collective over the processes in coll_pset_name, i.e. all processes in 
</span><span>               coll_pset_name have to call this function. All processes are guaranteed to receive the
</span><span>               same values. mpi://SELF may be used for individual lookups
</span></code></pre>
<hr />
<p><strong>PSet Operation Routines</strong></p>
<hr />
<pre data-lang="f90" style="background-color:#fafafa;color:#383a42;" class="language-f90 "><code class="language-f90" data-lang="f90"><span style="color:#a626a4;">interface
</span><span style="color:#a626a4;">subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_v2a_query_psetop</span><span> (</span><span style="color:#e45649;">session</span><span>, </span><span style="color:#e45649;">coll_pset</span><span>, </span><span style="color:#e45649;">input_pset</span><span>, </span><span style="color:#e45649;">type</span><span>, </span><span style="color:#e45649;">output_psets</span><span>, </span><span style="color:#e45649;">noutput</span><span>, </span><span style="color:#e45649;">ierror</span><span>)
</span><span>  integer,                        intent(in)    </span><span style="color:#a626a4;">::</span><span> session
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>,               </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)    </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">coll_pset
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>,               </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)    </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">input_pset
</span><span>  integer,                        intent(out)   </span><span style="color:#a626a4;">::</span><span> type
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">dimension</span><span>(*), </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">out</span><span>)   </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">output_psets
</span><span>  integer,                        intent(inout) </span><span style="color:#a626a4;">::</span><span> noutput
</span><span>  integer,                        intent(out)   </span><span style="color:#a626a4;">::</span><span> ierror
</span><span style="color:#a626a4;">end subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_v2a_query_psetop
</span><span style="color:#a626a4;">end interface
</span></code></pre>
<ul>
<li><code>output_psets</code> must be pre-allocated by the caller.</li>
<li><code>noutput</code> needs to be set to the number of entries in <code>output_psets</code>.</li>
<li>On sucessful return and <code>type != MPI_PSETOP_NULL</code>, <code>noutput</code> will be set to the number of output psets and the names of the output psets will be located in <code>noutputs</code>.</li>
</ul>
<p>From <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/#set-operations">the C documentation</a>:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>RETURN: 
</span><span>   - MPI_SUCCESS if operation was successful
</span><span>
</span><span>Description:   Queries for pending PSet Operation invloving the specified PSet.
</span><span>               This only applies to PSet operations involving changes of resources:
</span><span>                  -&gt; MPI_PSETOP_{ADD, SUB; GROW, SHRINK, REPLACE}
</span><span>               If no pending PSet operation is found for the specified PSet, op will be set to MPI_PSETOP_NULL
</span></code></pre>
<hr />
<br/>
<hr />
<pre data-lang="f90" style="background-color:#fafafa;color:#383a42;" class="language-f90 "><code class="language-f90" data-lang="f90"><span style="color:#a626a4;">interface
</span><span style="color:#a626a4;">subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_v2a_psetop</span><span> (</span><span style="color:#e45649;">session</span><span>, </span><span style="color:#e45649;">op</span><span>, </span><span style="color:#e45649;">input_sets</span><span>, </span><span style="color:#e45649;">ninput</span><span>, </span><span style="color:#e45649;">output_psets</span><span>, </span><span style="color:#e45649;">noutput</span><span>, </span><span style="color:#e45649;">info</span><span>, </span><span style="color:#e45649;">ierror</span><span>)
</span><span>   integer,                        intent(in)    </span><span style="color:#a626a4;">::</span><span> session
</span><span>   integer,                        intent(inout) </span><span style="color:#a626a4;">::</span><span> op
</span><span>   </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">dimension</span><span>(*), </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)    </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">input_sets
</span><span>   integer,                        intent(in)    </span><span style="color:#a626a4;">::</span><span> ninput
</span><span>   </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">dimension</span><span>(*), </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">inout</span><span>) </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">output_psets
</span><span>   integer,                        intent(inout) </span><span style="color:#a626a4;">::</span><span> noutput
</span><span>   integer,                        intent(inout) </span><span style="color:#a626a4;">::</span><span> info
</span><span>   integer,                        intent(out)   </span><span style="color:#a626a4;">::</span><span> ierror
</span><span style="color:#a626a4;">end subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_v2a_psetop
</span><span style="color:#a626a4;">end interface
</span></code></pre>
<ul>
<li><code>output_psets</code> must be pre-allocated by the caller.</li>
<li><code>noutput</code> needs to be set to the number of entries in <code>output_psets</code>.</li>
<li>On sucessful return <code>noutput</code> will be set to the number of output psets and the names of the output psets will be located in <code>noutputs</code>.</li>
</ul>
<p>From <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/#set-operations">the C documentation</a>:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>RETURN: 
</span><span>   - MPI_SUCCESS if operation was successful
</span><span>
</span><span>Description:   Requests the specified PSet Operation to be applied on the input PSets.
</span><span>               The info object can be used to specify parameters of the operation.
</span><span>               If successful, the function allocates an array of n_output PSet names.
</span><span>               It is the callers responsibility to free the PSet names and the output_psets array.
</span></code></pre>
<hr />
<br/>
<hr />
<pre data-lang="f90" style="background-color:#fafafa;color:#383a42;" class="language-f90 "><code class="language-f90" data-lang="f90"><span style="color:#a626a4;">interface
</span><span style="color:#a626a4;">subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_finalize_psetop</span><span>(</span><span style="color:#e45649;">session</span><span>, </span><span style="color:#e45649;">pset_name</span><span>, </span><span style="color:#e45649;">ierror</span><span>)
</span><span>  </span><span style="color:#a626a4;">implicit none
</span><span>  integer,          intent(in)  </span><span style="color:#a626a4;">::</span><span> session
</span><span>  </span><span style="color:#a626a4;">character(len=*)</span><span>, </span><span style="color:#a626a4;">intent</span><span>(</span><span style="color:#c18401;">in</span><span>)  </span><span style="color:#a626a4;">:: </span><span style="color:#e45649;">pset_name
</span><span>  integer,          intent(out) </span><span style="color:#a626a4;">::</span><span> ierror
</span><span style="color:#a626a4;">end subroutine </span><span style="color:#0184bc;">MPI_Session_dyn_finalize_psetop
</span><span style="color:#a626a4;">end interface
</span></code></pre>
<ul>
<li>Works analogously to the C version.</li>
</ul>
<p>From <a rel="noopener" target="_blank" href="https://gitlab.inria.fr/dynres/dyn-procs/ompi/#set-operations">the C documentation</a>:</p>
<pre style="background-color:#fafafa;color:#383a42;"><code><span>RETURN: 
</span><span>   - MPI_SUCCESS if operation was successful
</span><span>
</span><span>Description:   Indicates finalization of the PSet Operation.
</span><span>               This will make the operation unavailable for MPI_Session_dyn_v2a_query_psetop.
</span><span>               This only applies to PSet operations involving changes of resources:
</span><span>                  -&gt; MPI_PSETOP_{ADD, SUB; GROW, SHRINK, REPLACE}
</span></code></pre>
<hr />
</div>

      
    </div>


  </div> <!-- End of Container -->

  <!-- Footer -->
  <div class="container mb-3">
    <div class="text-muted">TUM Interdisciplinary Project, Jan Fecht, 2023. pictures & videos: <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">CC BY 3.0</a>, code snippets: <a rel="license" href="https://opensource.org/license/mit/">MIT</a></div>
  </div>

  <script src="https://fecht.cc/libpfasst-doc/bootstrap.bundle-5.3.0.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"></script>
  <script src="https://fecht.cc/libpfasst-doc/elasticlunr.min.js"></script>
  <script src="https://fecht.cc/libpfasst-doc/search.js"></script>
  <script>
// initialize search
if (document.readyState === "complete" ||
    (document.readyState !== "loading" && !document.documentElement.doScroll)
) {
  initSearch("https://fecht.cc/libpfasst-doc/");
} else {
  document.addEventListener("DOMContentLoaded", () => {initSearch("https://fecht.cc/libpfasst-doc/")});
}
  </script>
</body>

</html>
